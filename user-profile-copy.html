<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - PetConnect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow">
        <div class="max-w-6xl mx-auto flex justify-between items-center p-4">
            <h1 class="text-2xl font-bold text-indigo-700">My Profile</h1>
            <div class="space-x-4">
                <button onclick="window.location.href='index.html'" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                    ‚Üê Back to Dashboard
                </button>
                <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-6">
        <!-- Profile Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center space-x-6">
                <!-- Avatar Section -->
                <div class="relative">
                    <div id="avatarContainer" class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center border-4 border-white shadow">
                        <span id="avatarInitials" class="text-2xl font-bold text-indigo-600">?</span>
                    </div>
                    <input type="file" id="avatarUpload" accept="image/*" class="hidden">
                    <button onclick="document.getElementById('avatarUpload').click()" 
                            class="absolute -bottom-2 -right-2 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700">
                        üì∑
                    </button>
                </div>
                
                <!-- User Info -->
                <div class="flex-1">
                    <h2 id="userName" class="text-2xl font-bold text-gray-800">Loading...</h2>
                    <p id="userEmail" class="text-gray-600">Loading...</p>
                    <div class="flex space-x-2 mt-2">
                        <span id="userRole" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">Loading</span>
                        <span id="userStatus" class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">Active</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="border-b">
                <nav class="flex -mb-px">
                    <button id="tabBasic" class="py-4 px-6 font-medium border-b-2 border-indigo-600 text-indigo-600">
                        Basic Info
                    </button>
                    <button id="tabLifestyle" class="py-4 px-6 font-medium text-gray-500 hover:text-gray-700">
                        Lifestyle
                    </button>
                    <button id="tabActivity" class="py-4 px-6 font-medium text-gray-500 hover:text-gray-700">
                        Activity
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="p-6">
                <!-- Basic Info Tab -->
                <div id="contentBasic">
                    <form id="basicInfoForm" class="space-y-4 max-w-2xl">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="profileName" class="w-full p-3 border rounded-lg" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                <input type="text" id="profileLocation" class="w-full p-3 border rounded-lg" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="profileEmail" class="w-full p-3 border rounded-lg bg-gray-50" readonly>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                            <select id="profileRole" class="w-full p-3 border rounded-lg">
                                <option value="adopter">Adopter</option>
                                <option value="staff">Staff</option>
                                <option value="vet">Vet</option>
                                <option value="trainer">Trainer</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>

                        <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700">
                            Save Changes
                        </button>
                    </form>
                </div>

                <!-- Lifestyle Tab -->
                <div id="contentLifestyle" class="hidden">
                    <form id="lifestyleForm" class="space-y-4 max-w-2xl">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Activity Level</label>
                            <select id="activityLevel" class="w-full p-3 border rounded-lg">
                                <option value="">Select Activity Level</option>
                                <option value="high">High - Very active, outdoor activities</option>
                                <option value="medium">Medium - Regular walks, some playtime</option>
                                <option value="low">Low - Relaxed lifestyle, gentle walks</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Home Type</label>
                            <select id="homeType" class="w-full p-3 border rounded-lg">
                                <option value="">Select Home Type</option>
                                <option value="apartment">Apartment</option>
                                <option value="house_with_yard">House with Yard</option>
                                <option value="house_no_yard">House without Yard</option>
                                <option value="rural">Rural/Farm</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Personality Traits</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="personality" value="patient" class="mr-2">
                                    Patient
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="personality" value="energetic" class="mr-2">
                                    Energetic
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="personality" value="calm" class="mr-2">
                                    Calm
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="personality" value="experienced" class="mr-2">
                                    Experienced with pets
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Allergies (if any)</label>
                            <input type="text" id="allergies" placeholder="e.g., Cat dander, pollen" class="w-full p-3 border rounded-lg">
                        </div>

                        <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700">
                            Save Lifestyle Preferences
                        </button>
                    </form>
                </div>

                <!-- Activity Tab -->
                <div id="contentActivity" class="hidden">
                    <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                    <div id="activityList" class="space-y-3">
                        <div class="text-center text-gray-500 py-8">
                            Loading activity...
                        </div>
                    </div>
                </div>
            </div>
        </div>
<!-- Add this section to your user profile page -->
<div class="bg-white p-6 rounded-lg shadow-sm border mt-6">
    <h3 class="text-lg font-semibold mb-4">Browse Pets</h3>
    <p class="text-gray-600 mb-4">Find pets available for adoption or fostering</p>
    <div class="flex gap-3">
      <button onclick="window.location.href='pet-browser.html'" 
              class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">
        Browse All Pets
      </button>
      <button onclick="window.location.href='pet-browser.html?type=adoption'" 
              class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
        Pets for Adoption
      </button>
      <button onclick="window.location.href='pet-browser.html?type=fostering'" 
              class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
        Pets for Fostering
      </button>
    </div>
  </div>
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-lg shadow border">
                <h3 class="text-lg font-semibold text-gray-700">Favorited Pets</h3>
                <p id="favoriteCount" class="text-3xl font-bold text-indigo-600">0</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow border">
                <h3 class="text-lg font-semibold text-gray-700">Adoption Requests</h3>
                <p id="adoptionCount" class="text-3xl font-bold text-green-600">0</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow border">
                <h3 class="text-lg font-semibold text-gray-700">Member Since</h3>
                <p id="memberSince" class="text-lg font-medium text-gray-600">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="mt-3 text-gray-600">Loading...</p>
        </div>
    </div>

    <script>
        // JavaScript for profile functionality will go here
        // We'll add this in STEP 2
const API_BASE_URL = 'http://localhost:5001/api';
let token = localStorage.getItem('token');
let currentUser = null;

// Initialize profile page
document.addEventListener('DOMContentLoaded', function() {
    if (!token) {
        alert('Please login first');
        window.location.href = 'auth.html';
        return;
    }

    setupTabNavigation();
    loadUserProfile();
    setupEventListeners();
});

function setupTabNavigation() {
    const tabs = ['tabBasic', 'tabLifestyle', 'tabActivity'];
    const contents = ['contentBasic', 'contentLifestyle', 'contentActivity'];

    tabs.forEach(tabId => {
        document.getElementById(tabId).addEventListener('click', function() {
            // Update tab styles
            tabs.forEach(t => {
                const tab = document.getElementById(t);
                tab.classList.remove('border-indigo-600', 'text-indigo-600');
                tab.classList.add('text-gray-500');
            });
            this.classList.add('border-indigo-600', 'text-indigo-600');
            this.classList.remove('text-gray-500');

            // Show corresponding content
            contents.forEach(contentId => {
                document.getElementById(contentId).classList.add('hidden');
            });
            const contentId = 'content' + tabId.replace('tab', '');
            document.getElementById(contentId).classList.remove('hidden');

            // Load data when tab is clicked
            if (tabId === 'tabActivity') {
                loadUserActivity();
            }
        });
    });
}

function setupEventListeners() {
    // Logout button
    document.getElementById('logoutBtn').addEventListener('click', function() {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = 'auth.html';
    });

    // Basic info form
    document.getElementById('basicInfoForm').addEventListener('submit', updateBasicInfo);

    // Lifestyle form
    document.getElementById('lifestyleForm').addEventListener('submit', updateLifestyle);

    // Avatar upload
    document.getElementById('avatarUpload').addEventListener('change', handleAvatarUpload);
}

// async function loadUserProfile() {
//     showLoading();
//     try {
//         const response = await fetch(`${API_BASE_URL}/auth/me`, {
//             headers: { 'x-auth-token': token }
//         });
        
//         if (!response.ok) throw new Error('Failed to load profile');
        
//         currentUser = await response.json();
//         displayUserProfile(currentUser);
//         loadUserStats();
        
//     } catch (error) {
//         console.error('Error loading profile:', error);
//         alert('Failed to load profile data');
//     } finally {
//         hideLoading();
//     }
// }

// function displayUserProfile(user) {
//     // Basic info
//     document.getElementById('userName').textContent = user.name || 'Not set';
//     document.getElementById('userEmail').textContent = user.email;
//     document.getElementById('userRole').textContent = user.role;
    
//     // Avatar initials
//     const initials = user.name ? user.name.split(' ').map(n => n[0]).join('').toUpperCase() : '?';
//     document.getElementById('avatarInitials').textContent = initials;

//         // Avatar display
//         if (user.avatar && user.avatar.url) {
//         document.getElementById('avatarContainer').innerHTML = `
//             <img src="${user.avatar.url}" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow">
//         `;
//         document.getElementById('avatarInitials').classList.add('hidden');
//     } else {
//         document.getElementById('avatarContainer').innerHTML = `
//             <div class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center border-4 border-white shadow">
//                 <span id="avatarInitials" class="text-2xl font-bold text-indigo-600">${initials}</span>
//             </div>
//         `;
//     }


//     // Form fields
//     document.getElementById('profileName').value = user.name || '';
//     document.getElementById('profileLocation').value = user.location || '';
//     document.getElementById('profileEmail').value = user.email;
//     document.getElementById('profileRole').value = user.role;

//     // Lifestyle fields
//     if (user.lifestyle) {
//         document.getElementById('activityLevel').value = user.lifestyle.activityLevel || '';
//         document.getElementById('homeType').value = user.lifestyle.homeType || '';
//         document.getElementById('allergies').value = user.lifestyle.allergies ? user.lifestyle.allergies.join(', ') : '';
        
//         // Personality checkboxes
//         if (user.lifestyle.personalityTraits) {
//             user.lifestyle.personalityTraits.forEach(trait => {
//                 const checkbox = document.querySelector(`input[name="personality"][value="${trait}"]`);
//                 if (checkbox) checkbox.checked = true;
//             });
//         }
//     }

//     // Member since
//     if (user.createdAt) {
//         document.getElementById('memberSince').textContent = new Date(user.createdAt).toLocaleDateString();
//     }

// // FIXED: Avatar display - replace entire container
// if (user.avatar && user.avatar.url) {
//         document.getElementById('avatarContainer').innerHTML = `
//             <img src="${user.avatar.url}" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow">
//             <button onclick="document.getElementById('avatarUpload').click()" 
//                     class="absolute -bottom-2 -right-2 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700">
//                 üì∑
//             </button>
//         `;
//     } else {
//         const initials = user.name ? user.name.split(' ').map(n => n[0]).join('').toUpperCase() : '?';
//         document.getElementById('avatarContainer').innerHTML = `
//             <div class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center border-4 border-white shadow">
//                 <span class="text-2xl font-bold text-indigo-600">${initials}</span>
//             </div>
//             <button onclick="document.getElementById('avatarUpload').click()" 
//                     class="absolute -bottom-2 -right-2 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700">
//                 üì∑
//             </button>
//         `;
//     }

// }

async function loadUserProfile() {
    showLoading();
    try {
        const response = await fetch(`${API_BASE_URL}/auth/me`, {
            headers: { 'x-auth-token': token }
        });
        
        if (!response.ok) throw new Error('Failed to load profile');
        
        currentUser = await response.json();
        
        // ‚úÖ Check if user data is valid before displaying
        if (currentUser && currentUser.email) {
            displayUserProfile(currentUser);
            loadUserStats();
        } else {
            throw new Error('Invalid user data received');
        }
        
    } catch (error) {
        console.error('Error loading profile:', error);
        alert('Failed to load profile data. Please try logging in again.');
        // Redirect to login if profile fails to load
        window.location.href = 'auth.html';
    } finally {
        hideLoading();
    }
}

function displayUserProfile(user) {
    // ‚úÖ Safety check - ensure user data exists
    if (!user) {
        console.error('No user data provided to displayUserProfile');
        return;
    }

    // ‚úÖ Safety check - ensure DOM elements exist
    const userNameElement = document.getElementById('userName');
    const userEmailElement = document.getElementById('userEmail');
    const userRoleElement = document.getElementById('userRole');
    const avatarContainer = document.getElementById('avatarContainer');
    
    if (!userNameElement || !userEmailElement || !userRoleElement || !avatarContainer) {
        console.error('Required DOM elements not found');
        return;
    }

    try {
        // Basic info - with fallbacks
        userNameElement.textContent = user.name || 'Not set';
        userEmailElement.textContent = user.email || 'No email';
        userRoleElement.textContent = user.role || 'Unknown role';
        
        // Form fields - with safety checks
        const profileName = document.getElementById('profileName');
        const profileLocation = document.getElementById('profileLocation');
        const profileEmail = document.getElementById('profileEmail');
        const profileRole = document.getElementById('profileRole');
        
        if (profileName) profileName.value = user.name || '';
        if (profileLocation) profileLocation.value = user.location || '';
        if (profileEmail) profileEmail.value = user.email || '';
        if (profileRole) profileRole.value = user.role || 'adopter';

        // Lifestyle fields - with safety checks
        if (user.lifestyle) {
            const activityLevel = document.getElementById('activityLevel');
            const homeType = document.getElementById('homeType');
            const allergies = document.getElementById('allergies');
            
            if (activityLevel) activityLevel.value = user.lifestyle.activityLevel || '';
            if (homeType) homeType.value = user.lifestyle.homeType || '';
            if (allergies) allergies.value = user.lifestyle.allergies ? user.lifestyle.allergies.join(', ') : '';
            
            // Personality checkboxes - with safety checks
            if (user.lifestyle.personalityTraits) {
                user.lifestyle.personalityTraits.forEach(trait => {
                    const checkbox = document.querySelector(`input[name="personality"][value="${trait}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }

        // Avatar display - with safety check
        if (user.avatar && user.avatar.url) {
            avatarContainer.innerHTML = `
                <img src="${user.avatar.url}" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow">
                <button onclick="document.getElementById('avatarUpload').click()" 
                        class="absolute -bottom-2 -right-2 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700">
                    üì∑
                </button>
            `;
        } else {
            const initials = user.name ? user.name.split(' ').map(n => n[0]).join('').toUpperCase() : '?';
            avatarContainer.innerHTML = `
                <div class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center border-4 border-white shadow">
                    <span class="text-2xl font-bold text-indigo-600">${initials}</span>
                </div>
                <button onclick="document.getElementById('avatarUpload').click()" 
                        class="absolute -bottom-2 -right-2 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700">
                    üì∑
                </button>
            `;
        }

        // Member since - with safety check
        const memberSinceElement = document.getElementById('memberSince');
        if (memberSinceElement && user.createdAt) {
            memberSinceElement.textContent = new Date(user.createdAt).toLocaleDateString();
        }

    } catch (error) {
        console.error('Error in displayUserProfile:', error);
        alert('Error displaying profile data');
    }
}




async function loadUserStats() {
    try {
        // Load user's favorite pets count
        const petsResponse = await fetch(`${API_BASE_URL}/pets`, {
            headers: { 'x-auth-token': token }
        });
        
        if (petsResponse.ok) {
            const pets = await petsResponse.json();
            const favoriteCount = currentUser.favoritedPets ? currentUser.favoritedPets.length : 0;
            document.getElementById('favoriteCount').textContent = favoriteCount;
        }

        // Load adoption requests count (you'll need to implement this endpoint)
        // For now, we'll set a placeholder
        document.getElementById('adoptionCount').textContent = '0';
        
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

async function updateBasicInfo(event) {
    event.preventDefault();
    showLoading();
    
    try {
        const formData = {
            name: document.getElementById('profileName').value,
            location: document.getElementById('profileLocation').value,
            role: document.getElementById('profileRole').value
        };

        const response = await fetch(`${API_BASE_URL}/users/profile`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'x-auth-token': token
            },
            body: JSON.stringify(formData)
        });

        if (response.ok) {
            const updatedUser = await response.json();
            currentUser = updatedUser;
            displayUserProfile(updatedUser);
            alert('‚úÖ Profile updated successfully!');
        } else {
            throw new Error('Failed to update profile');
        }
    } catch (error) {
        console.error('Error updating profile:', error);
        alert('‚ùå Failed to update profile');
    } finally {
        hideLoading();
    }
}

async function updateLifestyle(event) {
    event.preventDefault();
    showLoading();
    
    try {
        const personalityCheckboxes = document.querySelectorAll('input[name="personality"]:checked');
        const personalityTraits = Array.from(personalityCheckboxes).map(cb => cb.value);
        
        const allergies = document.getElementById('allergies').value
            .split(',')
            .map(a => a.trim())
            .filter(a => a.length > 0);

        const lifestyleData = {
            activityLevel: document.getElementById('activityLevel').value,
            homeType: document.getElementById('homeType').value,
            personalityTraits: personalityTraits,
            allergies: allergies
        };

        const response = await fetch(`${API_BASE_URL}/users/profile`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'x-auth-token': token
            },
            body: JSON.stringify({ lifestyle: lifestyleData })
        });

        if (response.ok) {
            const updatedUser = await response.json();
            currentUser = updatedUser;
            alert('‚úÖ Lifestyle preferences saved!');
        } else {
            throw new Error('Failed to update lifestyle');
        }
    } catch (error) {
        console.error('Error updating lifestyle:', error);
        alert('‚ùå Failed to update lifestyle preferences');
    } finally {
        hideLoading();
    }
}

async function handleAvatarUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    // Validate file type and size
    if (!file.type.startsWith('image/')) {
        alert('Please select an image file');
        return;
    }

    // if (file.size > 5 * 1024 * 1024) {
    //     alert('Image must be less than 2MB');
    //     return;
    // }

        
        // Compress if over 2MB
        if (file.size > 8 * 1024 * 1024) {
            const options = {
                maxSizeMB: 2,
                maxWidthOrHeight: 1024,
                useWebWorker: true
            };
            fileToUpload = await imageCompression(file, options);
        }

    showLoading();
    
    try {
        const formData = new FormData();
        formData.append('avatar', file);

        const response = await fetch(`${API_BASE_URL}/users/upload-avatar`, {
            method: 'POST',
            headers: {
                'x-auth-token': token
            },
            body: formData
        });

        const data = await response.json();

        if (response.ok && data.success) {
            alert('‚úÖ Profile picture updated!');

            // ‚úÖ FIXED: Replace entire avatar container instead of modifying elements
            document.getElementById('avatarContainer').innerHTML = `
                <img src="${data.avatarUrl}" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow">
                <button onclick="document.getElementById('avatarUpload').click()" 
                        class="absolute -bottom-2 -right-2 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700">
                    üì∑
                </button>
            `;
            
            
            // Update current user data
            if (data.user) {
                currentUser = data.user;
            }
        } else {
            throw new Error(data.msg || 'Failed to upload avatar');
        }
    } catch (error) {
        console.error('Error uploading avatar:', error);
        alert('‚ùå Failed to upload profile picture: ' + error.message);
    } finally {
        hideLoading();
        event.target.value = ''; // Reset file input
    }
}




async function loadUserActivity() {
    try {
        const response = await fetch(`${API_BASE_URL}/users/activity-logs/${currentUser._id}`, {
            headers: { 'x-auth-token': token }
        });
        
        const activityList = document.getElementById('activityList');
        
        if (response.ok) {
            const activities = await response.json();
            
            if (activities.length > 0) {
                activityList.innerHTML = activities.map(activity => `
                    <div class="bg-gray-50 border rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium text-gray-800">${activity.action}</p>
                                <p class="text-sm text-gray-600">${activity.details || ''}</p>
                            </div>
                            <span class="text-xs text-gray-500">
                                ${new Date(activity.createdAt).toLocaleDateString()}
                            </span>
                        </div>
                    </div>
                `).join('');
            } else {
                activityList.innerHTML = '<p class="text-center text-gray-500 py-8">No recent activity</p>';
            }
        } else {
            activityList.innerHTML = '<p class="text-center text-gray-500 py-8">Unable to load activity</p>';
        }
    } catch (error) {
        console.error('Error loading activity:', error);
        document.getElementById('activityList').innerHTML = '<p class="text-center text-red-500 py-8">Error loading activity</p>';
    }
}

function showLoading() {
    document.getElementById('loadingOverlay').classList.remove('hidden');
}

function hideLoading() {
    document.getElementById('loadingOverlay').classList.add('hidden');
}


// Initialize profile page
document.addEventListener('DOMContentLoaded', function() {
    if (!token) {
        alert('Please login first');
        window.location.href = 'auth.html';
        return;
    }

    // Safety check - ensure required DOM elements exist
    const requiredElements = [
        'userName', 'userEmail', 'userRole', 'avatarContainer',
        'profileName', 'profileLocation', 'profileEmail', 'profileRole'
    ];
    
    const missingElements = requiredElements.filter(id => !document.getElementById(id));
    
    if (missingElements.length > 0) {
        console.error('Missing required DOM elements:', missingElements);
        alert('Page loading error. Please refresh.');
        return;
    }

    setupTabNavigation();
    loadUserProfile();
    setupEventListeners();
});



    </script>
</body>
</html>