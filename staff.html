<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pet Capstone - Staff Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .inter-font { font-family: 'Inter', sans-serif; }
    
    /* React-like styles */
    .staff-dashboard {
      min-height: 100vh;
      background: #f8fafc;
      font-family: 'Inter', sans-serif;
    }
    
    .staff-dashboard-header {
      background: white;
      border-bottom: 1px solid #e2e8f0;
      padding: 1rem 2rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .staff-header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .staff-dashboard-title {
      font-size: 1.875rem;
      font-weight: bold;
      color: #1e293b;
      margin: 0;
    }
    
    .staff-user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .staff-welcome-text {
      color: #64748b;
      font-size: 0.875rem;
    }
    
    .staff-header-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .staff-profile-btn, .staff-logout-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .staff-profile-btn {
      background: #f1f5f9;
      color: #475569;
    }
    
    .staff-logout-btn {
      background: #ef4444;
      color: white;
    }
    
    .staff-profile-btn:hover {
      background: #e2e8f0;
    }
    
    .staff-logout-btn:hover {
      background: #dc2626;
    }
    
    .staff-stats-grid {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    
    .staff-stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #3b82f6;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .staff-stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .staff-stat-card h3 {
      font-size: 0.875rem;
      color: #64748b;
      margin: 0 0 0.5rem 0;
      font-weight: 500;
    }
    
    .staff-stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #1e293b;
      margin: 0;
    }
    
    .staff-tabs {
      max-width: 1200px;
      margin: 0 auto 2rem auto;
      padding: 0 2rem;
      display: flex;
      gap: 0.5rem;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .staff-tab {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      color: #64748b;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .staff-tab:hover {
      color: #334155;
      background: #f8fafc;
    }
    
    .staff-tab-active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
      background: #f0f9ff;
    }
    
    .staff-main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem 2rem 2rem;
    }
    
    .staff-section {
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
      overflow: hidden;
      transition: box-shadow 0.2s;
    }
    
    .staff-section:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .staff-section-header {
      padding: 1.5rem;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8fafc;
    }
    
    .staff-section-header h2 {
      margin: 0;
      color: #1e293b;
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .staff-pet-form {
      padding: 1.5rem;
    }
    
    .staff-form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .staff-form-group {
      display: flex;
      flex-direction: column;
    }
    
    .staff-form-group.staff-form-full-width {
      grid-column: 1 / -1;
    }
    
    .staff-form-group label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.5rem;
    }
    
    .staff-form-input {
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    .staff-form-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .staff-form-select {
      padding: 0.75rem 2.5rem 0.75rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      background-color: white;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.75rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      cursor: pointer;
      transition: all 0.2s ease;
      appearance: none;
      font-family: inherit;
      color: #374151;
    }
    
    .staff-form-select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .staff-primary-btn {
      background: #3b82f6;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.875rem;
    }
    
    .staff-primary-btn:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .staff-form-submit {
      width: 100%;
      font-size: 1rem;
      padding: 1rem;
    }
    
    .staff-image-upload-input {
      border: 2px dashed #d1d5db;
      padding: 1rem;
      border-radius: 0.5rem;
      background: #f9fafb;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .staff-image-upload-input:hover {
      border-color: #3b82f6;
      background: #f0f9ff;
    }
    
    .staff-image-preview-container {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }
    
    .staff-image-preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      transition: transform 0.2s;
    }
    
    .staff-pets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      padding: 1.5rem;
    }
    
    .staff-pet-card {
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      overflow: hidden;
      background: white;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .staff-pet-card:hover {
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }
    
    .staff-pet-image-container {
      position: relative;
      overflow: hidden;
    }
    
    .staff-pet-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .staff-pet-card:hover .staff-pet-image {
      transform: scale(1.05);
    }
    
    .staff-pet-status {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .staff-pet-status-available { 
      background: linear-gradient(135deg, #10b981, #059669);
    }
    .staff-pet-status-in-treatment { 
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }
    .staff-pet-status-recovered { 
      background: linear-gradient(135deg, #3b82f6, #2563eb);
    }
    .staff-pet-status-ready-for-adoption { 
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    }
    
    .staff-pet-info {
      padding: 1.25rem;
    }
    
    .staff-pet-name {
      margin: 0 0 1rem 0;
      font-size: 1.25rem;
      font-weight: 700;
      color: #1f2937;
      border-bottom: 2px solid #f3f4f6;
      padding-bottom: 0.5rem;
    }
    
    .staff-pet-details {
      margin-bottom: 1.25rem;
    }
    
    .staff-pet-detail {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      padding: 0.25rem 0;
    }
    
    .staff-detail-label {
      color: #6b7280;
      font-weight: 500;
      flex-shrink: 0;
    }
    
    .staff-energy-level {
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .staff-energy-low { 
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    .staff-energy-medium { 
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      color: #92400e;
      border: 1px solid #fde68a;
    }
    .staff-energy-high { 
      background: linear-gradient(135deg, #fee2e2, #fecaca);
      color: #991b1b;
      border: 1px solid #fecaca;
    }
    
    .staff-pet-actions-grid {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    
    .staff-pet-actions-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }
    
    .staff-action-btn {
      padding: 0.5rem 0.75rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      text-align: center;
    }
    
    .staff-action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    .staff-action-secondary {
      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
      color: #475569;
      border: 1px solid #e2e8f0;
    }
    
    .staff-action-success {
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    
    .staff-action-danger {
      background: linear-gradient(135deg, #fee2e2, #fecaca);
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    
    .staff-action-warning {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      color: #92400e;
      border: 1px solid #fde68a;
    }
    
    .staff-requests-stats {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .staff-request-stat {
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .staff-request-stat.pending { 
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      color: #92400e;
      border: 1px solid #fde68a;
    }
    .staff-request-stat.approved { 
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    .staff-request-stat.meeting { 
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
      color: #1e40af;
      border: 1px solid #bfdbfe;
    }
    
    .staff-requests-list {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .staff-request-card {
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 1.5rem;
      background: white;
      transition: all 0.3s ease;
      border-left: 4px solid #3b82f6;
    }
    
    .staff-request-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }
    
    .staff-request-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .staff-request-pet-info h3 {
      margin: 0 0 0.25rem 0;
      color: #1f2937;
      font-size: 1.125rem;
      font-weight: 600;
    }
    
    .staff-request-breed {
      color: #6b7280;
      font-size: 0.875rem;
      font-style: italic;
    }
    
    .staff-request-status {
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }
    
    .staff-status-pending { 
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      color: #92400e;
    }
    .staff-status-approved { 
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #166534;
    }
    .staff-status-ignored { 
      background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
      color: #6b7280;
    }
    .staff-status-chat { 
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
      color: #1e40af;
    }
    .staff-status-meeting { 
      background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
      color: #7c3aed;
    }
    .staff-status-finalized { 
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #166534;
    }
    
    .staff-request-details {
      margin-bottom: 1.25rem;
      font-size: 0.875rem;
      color: #6b7280;
      background: #f8fafc;
      padding: 1rem;
      border-radius: 0.5rem;
    }
    
    .staff-request-adopter,
    .staff-request-contact,
    .staff-request-location {
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .staff-request-adopter strong,
    .staff-request-contact strong,
    .staff-request-location strong {
      color: #374151;
      min-width: 80px;
    }
    
    .staff-meeting-info {
      background: white;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      margin-top: 0.75rem;
    }
    
    .staff-meeting-detail {
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .staff-confirmed { 
      color: #10b981; 
      font-weight: 600;
      background: #dcfce7;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
    }
    .staff-pending { 
      color: #f59e0b; 
      font-weight: 600;
      background: #fef3c7;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
    }
    
    .staff-request-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .staff-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 1rem;
      backdrop-filter: blur(4px);
    }
    
    .staff-modal {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow: auto;
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .staff-modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8fafc;
      border-radius: 1rem 1rem 0 0;
    }
    
    .staff-modal-header h3 {
      margin: 0;
      color: #1f2937;
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .staff-modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.375rem;
      transition: all 0.2s;
    }
    
    .staff-modal-close:hover {
      color: #374151;
      background: #f3f4f6;
    }
    
    .staff-modal-body {
      padding: 1.5rem;
    }
    
    .staff-meeting-form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    
    .staff-meeting-preview {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      padding: 1.25rem;
      border-radius: 0.75rem;
      border: 1px solid #bae6fd;
      margin-top: 0.5rem;
    }
    
    .staff-meeting-preview p {
      margin: 0;
      color: #0c4a6e;
      font-size: 0.9rem;
      font-weight: 500;
      text-align: center;
    }
    
    .staff-modal-footer {
      padding: 1.5rem;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      background: #f8fafc;
      border-radius: 0 0 1rem 1rem;
    }
    
    @media (max-width: 768px) {
      .staff-header-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
      
      .staff-user-info {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .staff-header-actions {
        justify-content: center;
      }
      
      .staff-stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
        padding: 0 1rem;
      }
      
      .staff-tabs {
        flex-direction: column;
        padding: 0 1rem;
      }
      
      .staff-tab {
        text-align: center;
        border-bottom: none;
        border-left: 2px solid transparent;
      }
      
      .staff-tab-active {
        border-bottom: none;
        border-left: 2px solid #3b82f6;
      }
      
      .staff-main-content {
        padding: 0 1rem 1rem 1rem;
      }
      
      .staff-pets-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
        padding: 1rem;
      }
      
      .staff-pet-actions-row {
        grid-template-columns: 1fr;
      }
      
      .staff-request-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }
      
      .staff-request-status {
        align-self: flex-start;
      }
      
      .staff-request-actions {
        flex-direction: column;
      }
      
      .staff-requests-stats {
        justify-content: center;
      }
      
      .staff-form-grid {
        grid-template-columns: 1fr;
      }
      
      .staff-modal {
        margin: 0.5rem;
        width: calc(100% - 1rem);
      }
      
      .staff-modal-footer {
        flex-direction: column;
      }
    }
  </style>
</head>
<body class="inter-font bg-gray-50 min-h-screen">

  <div id="result" class="fixed top-0 inset-x-0 bg-opacity-90 py-3 text-center transition-all duration-300 transform -translate-y-full" style="z-index:100;"></div>

  <div class="staff-dashboard">
    <!-- Header -->
    <div class="staff-dashboard-header">
      <div class="staff-header-content">
        <h1 class="staff-dashboard-title">Staff Dashboard</h1>
        <div class="staff-user-info">
          <span id="userStatus" class="staff-welcome-text">Welcome, <strong>Loading...</strong></span>
          <div class="staff-header-actions">
            <button onclick="window.location.href='user-profile.html'" class="staff-profile-btn">
              üë§ Profile
            </button>
            <button id="logoutBtn" class="staff-logout-btn">
              Sign Out
            </button>
            <a href="/availability-management.html" class="staff-profile-btn">
              üìÖ Manage Availability
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Overview -->
    <div class="staff-stats-grid">
      <div class="staff-stat-card">
        <h3>Total Pets</h3>
        <p id="totalPets" class="staff-stat-number">0</p>
      </div>
      <div class="staff-stat-card">
        <h3>Available for Adoption</h3>
        <p id="availablePets" class="staff-stat-number">0</p>
      </div>
      <div class="staff-stat-card">
        <h3>In Treatment</h3>
        <p id="inTreatment" class="staff-stat-number">0</p>
      </div>
      <div class="staff-stat-card">
        <h3>Pending Requests</h3>
        <p id="pendingRequests" class="staff-stat-number">0</p>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="staff-tabs">
      <button id="petsTab" class="staff-tab staff-tab-active" onclick="switchTab('pets')">
        üêæ Pet Management
      </button>
      <button id="requestsTab" class="staff-tab" onclick="switchTab('requests')">
        üìã Adoption Requests (<span id="requestsCount">0</span>)
      </button>
    </div>

    <!-- Main Content -->
    <div class="staff-main-content">
      <!-- Pets Tab Content -->
      <div id="petsContent">
        <!-- Add Pet Form -->
        <div class="staff-section">
          <div class="staff-section-header">
            <h2>Add New Pet</h2>
          </div>
          <form id="addPetForm" class="staff-pet-form" enctype="multipart/form-data">
            <div class="staff-form-grid">
              <div class="staff-form-group">
                <label>Pet Name *</label>
                <input type="text" id="petName" class="staff-form-input" required placeholder="Enter pet name">
              </div>
              
              <div class="staff-form-group">
                <label>Breed</label>
                <input type="text" id="petBreed" class="staff-form-input" placeholder="Enter breed">
              </div>

              <div class="staff-form-group">
                <label>Age</label>
                <input type="number" id="petAge" class="staff-form-input" placeholder="Enter age">
              </div>

              <div class="staff-form-group">
                <label>Gender</label>
                <select id="petGender" class="staff-form-select">
                  <option value="">Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>

              <div class="staff-form-group">
                <label>Energy Level</label>
                <select id="petEnergy" class="staff-form-select">
                  <option value="">Select Energy Level</option>
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                </select>
              </div>

              <div class="staff-form-group">
                <label>Temperament</label>
                <input type="text" id="petTemperament" class="staff-form-input" placeholder="e.g., Friendly, Playful">
              </div>

              <div class="staff-form-group">
                <label>Organization *</label>
                <select id="petOrg" class="staff-form-select" required>
                  <option value="">Select Organization</option>
                </select>
              </div>

              <div class="staff-form-group staff-form-full-width">
                <label>Pet Images</label>
                <input type="file" id="petImages" multiple accept="image/*" class="staff-image-upload-input">
                <div id="imagePreview" class="staff-image-preview-container"></div>
              </div>
            </div>

            <button type="submit" class="staff-primary-btn staff-form-submit">
              Add Pet with Images
            </button>
          </form>
        </div>

        <!-- Pets List -->
        <div class="staff-section">
          <div class="staff-section-header">
            <h2>All Pets (<span id="totalPetsCount">0</span> total)</h2>
          </div>
          
          <div id="petsList" class="staff-pets-grid">
            <!-- Pets will be loaded here -->
          </div>
        </div>
      </div>

      <!-- Requests Tab Content -->
      <div id="requestsContent" style="display: none;">
        <div class="staff-section">
          <div class="staff-section-header">
            <h2>Adoption Requests</h2>
            <div class="staff-requests-stats">
              <span id="pendingRequestsStat" class="staff-request-stat pending">0 Pending</span>
              <span id="approvedRequestsStat" class="staff-request-stat approved">0 Approved</span>
              <span id="meetingRequestsStat" class="staff-request-stat meeting">0 Meetings</span>
            </div>
          </div>

          <div id="staffRequests" class="staff-requests-list">
            <!-- Requests will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Meeting Modal -->
  <div id="meetingModal" class="staff-modal-overlay" style="display: none;">
    <div class="staff-modal">
      <div class="staff-modal-header">
        <h3 id="meetingModalTitle">Schedule Meeting</h3>
        <button class="staff-modal-close" onclick="closeMeetingModal()">√ó</button>
      </div>
      <div class="staff-modal-body">
        <div class="staff-meeting-form">
          <div class="staff-form-group">
            <label>Meeting Date</label>
            <input type="date" id="meetingDate" class="staff-form-input">
          </div>
          <div class="staff-form-group">
            <label>Meeting Time</label>
            <input type="time" id="meetingTime" class="staff-form-input">
          </div>
          <div id="meetingPreview" class="staff-meeting-preview" style="display: none;">
            <p><strong>Scheduled for:</strong> <span id="meetingPreviewText"></span></p>
          </div>
        </div>
      </div>
      <div class="staff-modal-footer">
        <button class="staff-action-btn staff-action-secondary" onclick="closeMeetingModal()">
          Cancel
        </button>
        <button class="staff-action-btn staff-action-success" onclick="scheduleMeeting()">
          Schedule Meeting
        </button>
      </div>
    </div>
  </div>

  <script>
    // Your existing JavaScript code remains exactly the same
    const API_BASE_URL = "http://localhost:5001/api/auth";
    const PETS_API_URL = "http://localhost:5001/api/pets";
    const STAFF_API_URL = "http://localhost:5001/api/users";
    const ADOPTIONS_API_URL = "http://localhost:5001/api/adoptions";
    const ADOPTION_API_BASE_URL = "http://localhost:5001/api/adoptions"; 

    let token = localStorage.getItem("token");
    let currentMeetingRequestId = null;
    let isRescheduling = false;

    // Tab management
    function switchTab(tab) {
      // Update tabs
      document.getElementById('petsTab').classList.toggle('staff-tab-active', tab === 'pets');
      document.getElementById('requestsTab').classList.toggle('staff-tab-active', tab === 'requests');
      
      // Update content
      document.getElementById('petsContent').style.display = tab === 'pets' ? 'block' : 'none';
      document.getElementById('requestsContent').style.display = tab === 'requests' ? 'block' : 'none';
      
      if (tab === 'requests') {
        loadStaffRequests();
      }
    }

    // Update stats function
    function updateStats(pets, requests) {
      const totalPets = pets.length;
      const availablePets = pets.filter(pet => pet.status === 'Available').length;
      const inTreatment = pets.filter(pet => pet.status === 'In Treatment').length;
      const pendingRequests = requests.filter(req => req.status === 'pending').length;
      const approvedRequests = requests.filter(req => req.status === 'approved').length;
      const meetingScheduled = requests.filter(req => req.status === 'meeting').length;

      document.getElementById('totalPets').textContent = totalPets;
      document.getElementById('availablePets').textContent = availablePets;
      document.getElementById('inTreatment').textContent = inTreatment;
      document.getElementById('pendingRequests').textContent = pendingRequests;
      document.getElementById('requestsCount').textContent = requests.length;
      document.getElementById('totalPetsCount').textContent = totalPets;
      document.getElementById('pendingRequestsStat').textContent = `${pendingRequests} Pending`;
      document.getElementById('approvedRequestsStat').textContent = `${approvedRequests} Approved`;
      document.getElementById('meetingRequestsStat').textContent = `${meetingScheduled} Meetings`;
    }

    // Enhanced renderDashboard function
    const renderDashboard = async (user) => {
      try {
        const res = await fetchWithAuth(PETS_API_URL);
        const pets = await res.json();
        if(!res.ok) throw new Error("Failed to fetch pets");

        const petsList = document.getElementById("petsList");
        
        if(pets.length > 0){
          petsList.innerHTML = pets.map(pet => `
            <div class="staff-pet-card">
              <div class="staff-pet-image-container">
                ${pet.images && pet.images.length > 0 ? 
                  `<img src="${pet.images.find(img => img.isPrimary)?.url || pet.images[0].url}" 
                        class="staff-pet-image">` :
                  `<div class="staff-pet-image-placeholder">
                    No Image
                  </div>`
                }
                <div class="staff-pet-status staff-pet-status-${pet.status.toLowerCase().replace(' ', '-')}">
                  ${pet.status}
                </div>
              </div>
              
              <div class="staff-pet-info">
                <h3 class="staff-pet-name">${pet.name}</h3>
                <div class="staff-pet-details">
                  <div class="staff-pet-detail">
                    <span class="staff-detail-label">Breed:</span>
                    <span>${pet.breed || "Unknown"}</span>
                  </div>
                  <div class="staff-pet-detail">
                    <span class="staff-detail-label">Age:</span>
                    <span>${pet.age} years</span>
                  </div>
                  <div class="staff-pet-detail">
                    <span class="staff-detail-label">Energy:</span>
                    <span class="staff-energy-level staff-energy-${pet.energyLevel}">
                      ${pet.energyLevel}
                    </span>
                  </div>
                  <div class="staff-pet-detail">
                    <span class="staff-detail-label">Vet:</span>
                    <span>${pet.vet ? pet.vet.name : "Not assigned"}</span>
                  </div>
                </div>

                <div class="staff-pet-actions-grid">
                  <div class="staff-pet-actions-row">
                    <button onclick="addMoreImages('${pet._id}')" 
                            class="staff-action-btn staff-action-secondary">
                      üì∑ Add Images
                    </button>
                    <button onclick="deletePet('${pet._id}')" 
                            class="staff-action-btn staff-action-danger">
                      üóëÔ∏è Delete
                    </button>
                  </div>
                  
                  <div class="staff-pet-actions-row">
                    <select id="vetSelect-${pet._id}" class="staff-form-select staff-select-small">
                      <option value="">üë®‚Äç‚öïÔ∏è Assign Vet</option>
                    </select>
                    
                    <select id="statusSelect-${pet._id}" class="staff-form-select staff-select-small">
                      <option value="">üîÑ Update Status</option>
                      <option value="Available">Available</option>
                      <option value="In Treatment">In Treatment</option>
                      <option value="Recovered">Recovered</option>
                      <option value="Ready for Adoption">Ready for Adoption</option>
                    </select>
                  </div>
                  <div class="staff-pet-actions-row">
                    <button onclick="assignVet('${pet._id}')" 
                            class="staff-action-btn staff-action-secondary">
                      Assign Vet
                    </button>
                    <button onclick="updatePetStatus('${pet._id}')" 
                            class="staff-action-btn staff-action-success">
                      Update Status
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `).join("");
          
          await loadVetsForAssignment(pets);

          // Load requests for stats
          const requestsRes = await fetchWithAuth(`${ADOPTIONS_API_URL}/requests`);
          const requests = await requestsRes.json();
          if (requestsRes.ok) {
            updateStats(pets, requests);
          }

        } else { 
          petsList.innerHTML = `<p class="text-center text-gray-500 col-span-3">No pets available</p>`;
          updateStats([], []);
        }

      } catch(err){
        console.error(err);
        displayMessage("Failed to load pets", true);
      }
    };

    // Enhanced loadStaffRequests function
    const loadStaffRequests = async () => {
      try {
        const res = await fetchWithAuth(`${ADOPTIONS_API_URL}/requests`);
        const requests = await res.json();
        if (!res.ok) throw new Error("Failed to load requests");

        const container = document.getElementById('staffRequests');
        if(requests.length === 0){
          container.innerHTML = '<p class="text-gray-500 text-center py-4">No adoption requests</p>';
          return;
        }

        container.innerHTML = requests.map(req => {
          let actionButtons = '';

          switch(req.status){
            case 'pending':
              actionButtons = `
                <button onclick="handleRequest('${req._id}','approved')" 
                        class="staff-action-btn staff-action-success">‚úÖ Approve</button>
                <button onclick="handleRequest('${req._id}','ignored')" 
                        class="staff-action-btn staff-action-danger">‚ùå Ignore</button>
                <button onclick="handleRequest('${req._id}','chat')" 
                        class="staff-action-btn staff-action-secondary">üí¨ Chat</button>
                <button onclick="openMeetingModal('${req._id}', false)" 
                        class="staff-action-btn staff-action-warning">üìÖ Request Meeting</button>
              `;
              break;

            case 'approved':
              actionButtons = `
                <button onclick="handleRequest('${req._id}','chat')" 
                        class="staff-action-btn staff-action-secondary">üí¨ Chat Online</button>
                <button onclick="openMeetingModal('${req._id}', false)" 
                        class="staff-action-btn staff-action-warning">üìÖ Schedule Meeting</button>
              `;
              break;

            case 'chat':
              actionButtons = `
                <button onclick="handleRequest('${req._id}','finalized')" 
                        class="staff-action-btn staff-action-success">‚úÖ Finalize Adoption</button>
              `;
              break;

            case 'meeting':
              const meetingDate = req.meeting?.date ? new Date(req.meeting.date).toLocaleString() : 'Not set';
              const isConfirmed = req.meeting?.confirmed;
              
              actionButtons = `
                <div class="staff-meeting-info">
                  <div class="staff-meeting-detail">
                    <strong>Meeting:</strong> ${meetingDate}
                  </div>
                  <div class="staff-meeting-detail">
                    <strong>Confirmed:</strong>
                    <span class="${isConfirmed ? 'staff-confirmed' : 'staff-pending'}">
                      ${isConfirmed ? 'Yes' : 'No'}
                    </span>
                  </div>
                </div>
                <div class="staff-request-actions">
                  <button onclick="handleRequest('${req._id}','finalized')" 
                          class="staff-action-btn staff-action-success">‚úÖ Finalize</button>
                  <button onclick="openMeetingModal('${req._id}', true)" 
                          class="staff-action-btn staff-action-secondary">üìÖ Reschedule</button>
                  ${!isConfirmed ? `
                    <button onclick="sendMeetingReminder('${req._id}')" 
                            class="staff-action-btn staff-action-warning">üîî Send Reminder</button>
                  ` : ''}
                </div>
              `;
              break;
            default:
              actionButtons = `<span class="text-gray-500 italic">${req.status}</span>`;
          }

          return `
            <div class="staff-request-card staff-request-${req.status}">
              <div class="staff-request-header">
                <div class="staff-request-pet-info">
                  <h3>${req.pet.name}</h3>
                  <span class="staff-request-breed">${req.pet.breed}</span>
                </div>
                <div class="staff-request-status staff-status-${req.status}">
                  ${req.status}
                </div>
              </div>

              <div class="staff-request-details">
                <div class="staff-request-adopter">
                  <strong>Adopter:</strong> ${req.adopter.name}
                </div>
                <div class="staff-request-contact">
                  <strong>Email:</strong> ${req.adopter.email}
                </div>
                <div class="staff-request-location">
                  <strong>Location:</strong> ${req.adopter.location}
                </div>
              </div>

              <div class="staff-request-actions">
                ${actionButtons}
              </div>
            </div>
          `;
        }).join("");

      } catch(err){
        console.error(err);
        displayMessage("Failed to load adoption requests", true);
      }
    };

    // Meeting modal functions
    function openMeetingModal(requestId, reschedule = false) {
      currentMeetingRequestId = requestId;
      isRescheduling = reschedule;
      
      document.getElementById('meetingModalTitle').textContent = 
        isRescheduling ? 'Reschedule Meeting' : 'Schedule Meeting';
      
      // Set default values
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('meetingDate').value = tomorrow.toISOString().split('T')[0];
      document.getElementById('meetingTime').value = "10:00";
      
      document.getElementById('meetingModal').style.display = 'flex';
    }

    function closeMeetingModal() {
      document.getElementById('meetingModal').style.display = 'none';
      currentMeetingRequestId = null;
      isRescheduling = false;
    }

    async function scheduleMeeting() {
      const meetingDate = document.getElementById('meetingDate').value;
      const meetingTime = document.getElementById('meetingTime').value;
      
      if (!meetingDate || !meetingTime || !currentMeetingRequestId) {
        alert("Please select both date and time");
        return;
      }

      try {
        const isoDateTime = new Date(`${meetingDate}T${meetingTime}`).toISOString();
        await handleRequest(currentMeetingRequestId, 'meeting', isoDateTime);
        closeMeetingModal();
      } catch (error) {
        alert("Invalid date/time selected");
      }
    }

    // Update handleRequest to accept meeting date
    const handleRequest = async (requestId, action, meetingDate) => {
      try {
        const body = meetingDate ? 
          JSON.stringify({ status: action, meetingDate }) : 
          JSON.stringify({ status: action });
          
        const res = await fetchWithAuth(`${ADOPTIONS_API_URL}/${requestId}/status`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: body
        });
        const data = await res.json();
        if(res.ok){
          displayMessage(`Request ${action} successfully!`);
          await loadStaffRequests();
          await loadUserAndDashboard();
        } else displayMessage(data.msg || 'Failed to update request', true);
      } catch(err){
        console.error(err);
        displayMessage('Server error', true);
      }
    }

    // Your existing utility functions remain exactly the same
    const displayMessage = (msg, err=false)=>{
      const r=document.getElementById("result");
      r.innerText=msg;
      r.className=`fixed top-0 inset-x-0 py-3 text-center transform translate-y-0 ${err?'bg-red-500':'bg-green-500'} text-white`;
      clearTimeout(window.msgTimeout);
      window.msgTimeout=setTimeout(()=>{r.classList.add("-translate-y-full")},4000);
    };

    const fetchWithAuth = (url,opt={})=>{
      return fetch(url,{...opt,headers:{'Content-Type':'application/json','x-auth-token':token,...opt.headers}});
    };

    const setViewState = (logged,user)=>{
      if(logged){
        document.getElementById("userStatus").innerHTML=`Welcome, <strong>${user.name}</strong>`;
        renderDashboard(user);
      } else {
        localStorage.removeItem("token");
        token=null;
        window.location.href = "index.html";
      }
    };

    const loadUserAndDashboard = async () => {
      if(!token){ setViewState(false); return; }
      try {
        const res = await fetchWithAuth(`${API_BASE_URL}/me`);
        const user = await res.json();
        if(res.ok) {
          setViewState(true, user);
        }
        else { displayMessage(user.msg||"Session expired", true); setViewState(false); }
      } catch {
        displayMessage("Server error", true);
        setViewState(false);
      }
    };

    // Image Preview Function
    document.getElementById('petImages').addEventListener('change', function(e) {
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = '';
      
      Array.from(e.target.files).forEach(file => {
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'staff-image-preview';
            preview.appendChild(img);
          };
          reader.readAsDataURL(file);
        }
      });
    });

    // Load organizations when DOM is ready
    const loadOrganizations = async () => {
      try {
        const res = await fetchWithAuth("http://localhost:5001/api/organizations");
        const orgs = await res.json();
        if(!res.ok) throw new Error("Failed to fetch organizations");

        const orgSelect = document.getElementById("petOrg");
        orgs.forEach(org => {
          const option = document.createElement("option");
          option.value = org._id;
          option.text = org.name;
          orgSelect.appendChild(option);
        });
      } catch(err){
        console.error(err);
      }
    };

    // Vet assignment
    const loadVetsForAssignment = async (pets) => {
      try {
        const res = await fetchWithAuth(`${STAFF_API_URL}/vets`);
        const vets = await res.json();
        if(!res.ok) throw new Error("Failed to fetch vets");

        pets.forEach(pet=>{
          const sel = document.getElementById(`vetSelect-${pet._id}`);
          if (sel) {
            vets.forEach(vet=> {
              const option = document.createElement("option");
              option.value = vet._id;
              option.text = vet.name;
              sel.appendChild(option);
            });
          }
        });
      } catch(err){
        console.error(err);
      }
    };

    const assignVet = async(petId)=>{
      const sel = document.getElementById(`vetSelect-${petId}`);
      const vetId = sel.value;
      if(!vetId) return alert("Select a vet first");

      try {
        const res = await fetchWithAuth(`${PETS_API_URL}/${petId}/assign-vet`,{
          method:"PATCH",
          body: JSON.stringify({vetId})
        });
        const data = await res.json();
        if(res.ok) {displayMessage("Vet assigned successfully"); await loadUserAndDashboard();}
        else displayMessage(data.msg||"Assignment failed",true);
      } catch(err){displayMessage("Server error",true);}
    };

    // Delete pet logic
    const deletePet = async (petId) => {
      if(!confirm("Are you sure you want to delete this pet?")) return;

      try {
        const res = await fetchWithAuth(`${PETS_API_URL}/${petId}`, { method: 'DELETE' });
        const data = await res.json();
        if(res.ok){
          displayMessage(data.msg || "Pet deleted successfully");
          await loadUserAndDashboard();
        } else displayMessage(data.msg || "Failed to delete pet", true);
      } catch(err){
        console.error(err);
        displayMessage("Server error", true);
      }
    };

    // Add more images to existing pet
    async function addMoreImages(petId) {
      const input = document.createElement('input');
      input.type = 'file';
      input.multiple = true;
      input.accept = 'image/*';
      
      input.onchange = async (e) => {
        const files = e.target.files;
        if (files.length === 0) return;

        const formData = new FormData();
        for (let i = 0; i < files.length; i++) {
          formData.append('images', files[i]);
        }

        try {
          const res = await fetch(`http://localhost:5001/api/pet-images/${petId}/upload-images`, {
            method: 'POST',
            headers: {
              'x-auth-token': token
            },
            body: formData
          });

          const data = await res.json();
          if (res.ok) {
            displayMessage(`${files.length} images added successfully!`);
            await loadUserAndDashboard();
          } else {
            displayMessage(data.msg || 'Failed to add images', true);
          }
        } catch (err) {
          console.error(err);
          displayMessage('Server error', true);
        }
      };

      input.click();
    }

    // Update pet status
    async function updatePetStatus(petId) {
      const sel = document.getElementById(`statusSelect-${petId}`);
      const newStatus = sel.value;
      if (!newStatus) return alert("Please select a status");

      try {
        const res = await fetchWithAuth(`http://localhost:5001/api/pets/${petId}/status`, {
          method: "PATCH",
          body: JSON.stringify({ status: newStatus })
        });
        const data = await res.json();
        if (res.ok) {
          displayMessage(`Status updated to ${newStatus}`);
          await loadUserAndDashboard();
        } else {
          displayMessage(data.msg || "Failed to update status", true);
        }
      } catch (err) {
        console.error(err);
        displayMessage("Server error", true);
      }
    }

    // Submit handler (for Add Pet)
    const addPetForm = document.getElementById('addPetForm');
    addPetForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      try {
        // ADD PET with images (use FormData)
        const formData = new FormData();
        formData.append('name', document.getElementById('petName').value);
        formData.append('breed', document.getElementById('petBreed').value);
        formData.append('age', document.getElementById('petAge').value);
        formData.append('gender', document.getElementById('petGender').value);
        formData.append('energyLevel', document.getElementById('petEnergy').value);
        formData.append('temperament', document.getElementById('petTemperament').value);
        formData.append('organization', document.getElementById('petOrg').value);

        // Append images
        const imageFiles = document.getElementById('petImages').files;
        for (let i = 0; i < imageFiles.length; i++) {
          formData.append('images', imageFiles[i]);
        }

        const res = await fetch(PETS_API_URL, {
          method: 'POST',
          headers: {
            'x-auth-token': token
          },
          body: formData
        });
        
        const data = await res.json();
        if(res.ok){
          displayMessage("Pet added successfully with images!");
          addPetForm.reset();
          document.getElementById('imagePreview').innerHTML = '';
          await loadUserAndDashboard();
        } else {
          displayMessage(data.msg || "Failed to add pet", true);
        }
      } catch(err){
        console.error(err);
        displayMessage("Server error", true);
      }
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click",()=>{
      localStorage.removeItem("token"); 
      window.location.href="index.html";
    });

    // Initialize everything
    document.addEventListener("DOMContentLoaded", function() {
      loadUserAndDashboard();
      loadOrganizations();
    });
  </script>
</body>
</html>